@page "/admin/system"

@using MoonCore.Extensions
@using MoonCore.Helpers
@using Moonlight.Client.App.Services
@using Moonlight.Shared.Http.Resources.Admin.Sys

@inject IdentityService IdentityService

<Breadcrumb Names="@(["Admin", "System"])" Links="@(["/admin"])" />

<div class="mt-3">
    <NavTabs Index="0" TextSize="text-base" Names="@(["System information", "Diagnose"])" Links="@(["/admin/system", "/admin/system/diagnose"])" />
</div>

<LazyLoader Load="Load">
    <div class="mt-5 gap-5 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4">
        <StatCard Title="CPU Usage" Text="@(SystemInfo.CpuUsage + "%")" Icon="bi bi-cpu" />
        <StatCard Title="Memory Usage" Text="@(Formatter.FormatSize(SystemInfo.MemoryUsage))" Icon="bi bi-memory" />
        <StatCard Title="Host OS" Text="@(SystemInfo.OsName)" Icon="bi bi-motherboard" />
        <StatCard Title="Uptime" Text="@(Formatter.FormatUptime(SystemInfo.Uptime))" Icon="bi bi-clock-history" />
    </div>
</LazyLoader>

@code
{
    private SystemInfoResponse SystemInfo;
    
    private async Task Load(LazyLoader arg)
    {
        var response = await IdentityService.Http.GetAsync("admin/system/info");

        await response.HandlePossibleApiError();

        SystemInfo = await response.ParseAsJson<SystemInfoResponse>();
    }
}
